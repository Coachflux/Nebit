<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nebit Crypto — Register / Login</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: "Poppins", sans-serif;
    background: radial-gradient(circle at top, #08121e, #0b182a, #02060b);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    flex-direction: column;
  }

  .container {
    background: #0f1e33;
    border-radius: 20px;
    box-shadow: 8px 8px 16px #050a12, -8px -8px 16px #1a355a;
    width: 90%;
    max-width: 400px;
    padding: 25px;
    text-align: center;
  }

  h2 {
    margin-bottom: 10px;
    color: #00f7ff;
  }

  .input-group {
    text-align: left;
    margin-top: 15px;
  }

  label {
    font-size: 14px;
    color: #b3c9e1;
  }

  input {
    width: 100%;
    padding: 10px;
    border-radius: 10px;
    border: none;
    margin-top: 5px;
    background: #0b1624;
    color: #fff;
    font-size: 15px;
  }

  button {
    margin-top: 20px;
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 15px;
    background: linear-gradient(135deg, #00c3ff, #0072ff);
    color: #fff;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
  }

  button:hover {
    background: linear-gradient(135deg, #0072ff, #00c3ff);
  }

  .switch {
    margin-top: 15px;
    color: #9fc9ff;
    cursor: pointer;
    text-decoration: underline;
  }

  .google-btn {
    background: #fff;
    color: #000;
    margin-top: 15px;
    font-weight: 600;
  }

  .sparkle {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background-image: radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 20px 20px;
    pointer-events: none;
    z-index: 0;
  }
</style>
</head>
<body>

<div class="sparkle"></div>

<div class="container">
  <h2 id="form-title">Register</h2>

  <div id="register-form">
    <div class="input-group">
      <label>Username (Referral Code)</label>
      <input type="text" id="reg-username" placeholder="Enter username" required>
    </div>
    <div class="input-group">
      <label>Email</label>
      <input type="email" id="reg-email" placeholder="Enter email" required>
    </div>
    <div class="input-group">
      <label>Password</label>
      <input type="password" id="reg-password" placeholder="Enter password" required>
    </div>
    <div class="input-group">
      <label>Referral Code (optional)</label>
      <input type="text" id="reg-referral" placeholder="Referred by username?">
    </div>
    <button onclick="register()">Register</button>
    <button class="google-btn" onclick="googleAuth()">Continue with Google</button>
    <p class="switch" onclick="toggleForm()">Already have an account? Login</p>
  </div>

  <div id="login-form" style="display:none;">
    <div class="input-group">
      <label>Email</label>
      <input type="email" id="login-email" placeholder="Enter email">
    </div>
    <div class="input-group">
      <label>Password</label>
      <input type="password" id="login-password" placeholder="Enter password">
    </div>
    <button onclick="login()">Login</button>
    <button class="google-btn" onclick="googleAuth()">Continue with Google</button>
    <p class="switch" onclick="toggleForm()">Don’t have an account? Register</p>
  </div>
</div>

<script type="module">
  // Import Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MSG_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  window.register = async () => {
    const username = document.getElementById('reg-username').value.trim();
    const email = document.getElementById('reg-email').value.trim();
    const password = document.getElementById('reg-password').value;
    const refcode = document.getElementById('reg-referral').value.trim();

    if (!username || !email || !password) {
      alert("Please fill all fields!");
      return;
    }

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      await setDoc(doc(db, "users", user.uid), {
        username,
        email,
        referralCode: username,
        referredBy: refcode || null,
        referralCount: 0,
        balance: 0,
        createdAt: new Date().toISOString()
      });

      alert("Registration successful!");
      window.location.href = "login.html";
    } catch (error) {
      alert(error.message);
    }
  };

  window.login = async () => {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;

    try {
      await signInWithEmailAndPassword(auth, email, password);
      window.location.href = "referral-dashboard.html";
    } catch (error) {
      alert(error.message);
    }
  };

  window.googleAuth = async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;

      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        await setDoc(ref, {
          username: user.displayName || "User",
          email: user.email,
          referralCode: (user.displayName || "User") + Math.floor(Math.random() * 1000),
          referredBy: null,
          referralCount: 0,
          balance: 0,
          createdAt: new Date().toISOString()
        });
      }
      window.location.href = "referral-dashboard.html";
    } catch (err) {
      alert(err.message);
    }
  };
</script>

<script>
function toggleForm() {
  const reg = document.getElementById('register-form');
  const log = document.getElementById('login-form');
  const title = document.getElementById('form-title');

  if (reg.style.display === "none") {
    reg.style.display = "block";
    log.style.display = "none";
    title.textContent = "Register";
  } else {
    reg.style.display = "none";
    log.style.display = "block";
    title.textContent = "Login";
  }
}
</script>

</body>
</html>
