<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login â€” USDT Miner</title>
<style>
  body{margin:0;background:linear-gradient(135deg,#061021,#10203a);font-family:Inter,Arial;color:#e6f7ff;display:flex;align-items:center;justify-content:center;height:100vh}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(0,0,0,0.06));padding:28px;border-radius:16px;max-width:420px;width:92%;box-shadow:0 20px 50px rgba(0,0,0,0.6)}
  h1{margin:0 0 8px;color:#9ff6ff;text-align:center}
  input{width:100%;padding:11px;border-radius:10px;border:none;margin-top:6px;background:#071827;color:#e6f7ff}
  .btn{margin-top:14px;padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg,#00d4ff,#7b5cff);color:#021427;font-weight:800;cursor:pointer;width:100%}
  .google{display:flex;align-items:center;justify-content:center;gap:10px;padding:10px;border-radius:10px;background:#fff;color:#000;margin-top:10px;cursor:pointer}
  .note{color:#7fa9bf;font-size:13px;text-align:center;margin-top:12px}
</style>
</head>
<body>
  <div class="card">
    <h1>Login</h1>
    <input id="email" type="email" placeholder="you@example.com">
    <input id="password" type="password" placeholder="Password">
    <button id="loginBtn" class="btn">Login</button>

    <div id="googleBtn" class="google">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" alt="Google"> Continue with Google
    </div>

    <div style="text-align:center;margin-top:12px"><a href="register.html" style="color:#9ff6ff;text-decoration:none">Need an account? Register</a></div>
  </div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDR_rkTfGLWWX4NRWOVer9wwGlUFiRMRO4",
    authDomain: "usdt-login.firebaseapp.com",
    databaseURL: "https://usdt-login-default-rtdb.firebaseio.com",
    projectId: "usdt-login",
    storageBucket: "usdt-login.firebasestorage.app",
    messagingSenderId: "807602854227",
    appId: "1:807602854227:web:309ae73f572e48dbc7a9a6"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  document.getElementById('loginBtn').addEventListener('click', async ()=>{
    const email = (document.getElementById('email').value || '').trim();
    const password = document.getElementById('password').value;
    if(!email || !password) { alert('Enter email and password'); return; }
    try{
      const cred = await auth.signInWithEmailAndPassword(email,password);
      const uid = cred.user.uid;
      const udoc = await db.collection('users').doc(uid).get();
      if(udoc.exists){
        // store local for referral page convenience
        localStorage.setItem('uid', uid);
        localStorage.setItem('username', udoc.data().username || '');
      }
      window.location.href = 'referral.html';
    }catch(err){ alert(err.message || 'Login failed'); }
  });

  document.getElementById('googleBtn').addEventListener('click', async ()=>{
    const provider = new firebase.auth.GoogleAuthProvider();
    try{
      const result = await auth.signInWithPopup(provider);
      const user = result.user;
      // ensure user doc exists (it may have been created at register)
      const uref = db.collection('users').doc(user.uid);
      const snap = await uref.get();
      if(!snap.exists){
        // write minimal user doc
        await uref.set({
          username: (user.displayName||user.email||'user').replace(/\s+/g,'').toLowerCase(),
          email: user.email || '',
          referralCode: (user.displayName||user.email||'user').split('@')[0],
          referredBy: null,
          referralCount: 0,
          createdAt: new Date().toISOString()
        });
      }
      localStorage.setItem('uid', user.uid);
      localStorage.setItem('username', snap.exists ? snap.data().username : ((user.displayName||user.email||'user').replace(/\s+/g,'').toLowerCase()));
      window.location.href = 'referral.html';
    }catch(err){ alert(err.message || 'Google login failed'); }
  });
</script>
</body>
</html>
