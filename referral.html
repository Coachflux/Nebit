<!-- referral.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Referral Dashboard — USDT Miner</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{--bg:#051426;--card:#08273e;--accent1:#00e0ff;--accent2:#7b5cff;--muted:#9fbfd4}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#021425);font-family:Inter;color:#e9fbff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
  .card{width:100%;max-width:520px;background:linear-gradient(180deg,#071a2b,#0b2740);padding:24px;border-radius:14px;box-shadow:0 24px 60px rgba(0,0,0,0.6)}
  h1{margin:0;color:#bff8ff;text-align:center}
  .hero{margin-top:12px;border-radius:12px;overflow:hidden;height:200px;background:#071827;display:flex;align-items:center;justify-content:center}
  .row{display:flex;gap:10px;margin-top:12px}
  .btn{flex:1;padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021427;font-weight:800;cursor:pointer}
  .info{margin-top:12px;background:linear-gradient(180deg,#0b1624,#072033);padding:14px;border-radius:10px}
  .info div{margin-bottom:8px}
  .invite{margin-top:12px;padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021427;font-weight:800;cursor:pointer;width:100%}
  .small{font-size:13px;color:var(--muted);margin-top:10px;text-align:center}
  .footer{margin-top:12px;text-align:center;color:var(--muted)}
  .popup{position:fixed;left:0;right:0;top:0;bottom:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center}
  .modal{background:#071827;padding:18px;border-radius:12px;color:#e9fbff;max-width:420px;width:92%}
  .modal button{margin-top:12px;padding:10px;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(90deg,var(--accent1),var(--accent2));font-weight:700}
</style>
</head>
<body>
  <div class="card">
    <h1>USDT Miner — Referral</h1>
    <div class="hero">
      <video src="https://cdn.pixabay.com/video/2022/03/06/21-24-23-592_720.mp4" autoplay muted loop playsinline style="width:100%;height:100%;object-fit:cover"></video>
    </div>

    <div class="row">
      <button id="leftBtn" class="btn">Claim 100NEB</button>
      <button id="rightBtn" class="btn">Claim $50 BNB</button>
    </div>

    <div class="info">
      <div>Username: <strong id="usernameSpan">-</strong></div>
      <div>Referral Code: <strong id="codeSpan">-</strong></div>
      <div>People Invited: <strong id="countSpan">0</strong></div>
    </div>

    <button id="inviteBtn" class="invite">Invite — Share Link</button>
    <button id="simulateBtn" style="margin-top:10px;padding:10px;border-radius:8px;background:#0b1624;border:none;color:#9fbfd4;cursor:pointer;width:100%">Simulate Invite (dev)</button>

    <div class="small">Share link will point to: <br><code id="shareExample" style="color:#9ff6ff"></code></div>
    <div class="footer">© Nebit Campaign, 2025. Powered by BRAVE.</div>
  </div>

  <!-- modal -->
  <div id="popup" class="popup">
    <div class="modal">
      <div id="popupText">Share this link</div>
      <button id="popupClose">Close</button>
    </div>
  </div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBqdPdqxg-ETwxu7CZp68myh2kW4hD_aO8",
  authDomain: "nebit-drop.firebaseapp.com",
  databaseURL: "https://nebit-drop-default-rtdb.firebaseio.com",
  projectId: "nebit-drop",
  storageBucket: "nebit-drop.firebasestorage.app",
  messagingSenderId: "316280534789",
  appId: "1:316280534789:web:9903fdb98b5cb4ff60a96c"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const usernameSpan = document.getElementById('usernameSpan');
const codeSpan = document.getElementById('codeSpan');
const countSpan = document.getElementById('countSpan');
const shareExample = document.getElementById('shareExample');
const popup = document.getElementById('popup');
const popupText = document.getElementById('popupText');

let currentUser = null;
auth.onAuthStateChanged(async (user) => {
  if(!user){ window.location.href = 'login.html'; return; }
  currentUser = user;
  const doc = await db.collection('users').doc(user.uid).get();
  if(!doc.exists){ alert('No user data — contact support'); return; }
  const d = doc.data();
  usernameSpan.textContent = d.username || d.email || '-';
  codeSpan.textContent = d.referralCode || d.username || '-';
  countSpan.textContent = d.referralCount || 0;
  const link = `https://usdtmining.github.io/USDT/index.html?ref=${encodeURIComponent(d.referralCode || d.username)}`;
  shareExample.textContent = link;
});

/* share */
document.getElementById('inviteBtn').addEventListener('click', async ()=>{
  if(!currentUser) return window.location.href='login.html';
  const doc = await db.collection('users').doc(currentUser.uid).get();
  const d = doc.data();
  const link = `https://usdtmining.github.io/USDT/index.html?ref=${encodeURIComponent(d.referralCode || d.username)}`;
  const text = `Join USDT Miner with code ${d.referralCode || d.username}\n${link}`;
  if(navigator.share){
    navigator.share({title:'Join USDT Miner',text, url:link}).catch(()=>{});
  } else {
    // show modal with copy button
    popupText.textContent = text;
    popup.style.display='flex';
    navigator.clipboard.writeText(text).catch(()=>{});
  }
});
document.getElementById('popupClose').addEventListener('click', ()=> popup.style.display='none');

/* simulate invite -> creates referralEvents doc (server function should pick it and increment the referrer's referralCount) */
document.getElementById('simulateBtn').addEventListener('click', async ()=>{
  if(!currentUser) return window.location.href='login.html';
  const doc = await db.collection('users').doc(currentUser.uid).get();
  const code = doc.exists ? (doc.data().referralCode || doc.data().username) : null;
  if(!code) return alert('No referral code found');
  try{
    await db.collection('referralEvents').add({
      referralCode: code,
      newUid: 'sim-' + Date.now(),
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    alert('Simulated referral event created. Cloud Function should credit your account shortly.');
  } catch(err){
    alert(err.message || 'Failed to create event');
  }
});

/* reward buttons UI */
document.getElementById('leftBtn').addEventListener('click', ()=> {
  document.getElementById('leftBtn').style.boxShadow='0 8px 30px rgba(0,224,255,0.12)';
  document.getElementById('rightBtn').style.boxShadow='none';
});
document.getElementById('rightBtn').addEventListener('click', ()=> {
  document.getElementById('rightBtn').style.boxShadow='0 8px 30px rgba(123,92,255,0.12)';
  document.getElementById('leftBtn').style.boxShadow='none';
});
</script>
</body>
</html>
